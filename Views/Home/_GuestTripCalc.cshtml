<h4>Trip Cost Calculator</h4>

<form id="tripForm">

    <!-- Base vehicle info -->
    <div class="mb-3">
        <label class="form-label">Distance (km)</label>
        <input type="number" id="distance" class="form-control" placeholder="e.g. 120" required>
    </div>

    <div class="mb-3">
        <label class="form-label">Fuel Consumption (L / 100km)</label>
        <input type="number" id="consumption" class="form-control" placeholder="e.g. 7.5" required>
    </div>

    <!-- Fuel -->
    <div class="mb-3">
        <label class="form-label">Fuel Type</label>
        <select id="fuelType" class="form-select">
            <option>Petrol A95</option>
            <option>Diesel</option>
            <option>LPG</option>
            <option>Petrol A98</option>
            <option>Diesel Premium</option>
        </select>
    </div>

    <div class="mb-3">
        <label class="form-label">Fuel Price (€ / liter)</label>
        <input type="number" id="fuelPrice" class="form-control" placeholder="e.g. 1.25" required>
    </div>

    <!-- Vignette validity check -->
    <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" id="hasVignette">
        <label class="form-check-label">
            Have a valid vignette or driving a motorcycle?
        </label>
    </div>

    <!-- Vignette selection -->
    <div id="vignetteSection">

        <div class="mb-3">
            <label class="form-label">Trip Start</label>
            <input type="date" id="startDate" class="form-control">
        </div>

        <div class="mb-3">
            <label class="form-label">Trip End</label>
            <input type="date" id="endDate" class="form-control">
        </div>

        <div class="mb-3">
            <label class="form-label">Vignette Type</label>
            <select id="vignetteType" class="form-select"></select>
        </div>

    </div>

    <button type="button" class="btn btn-primary" onclick="calculateCost()">
        Calculate
    </button>
</form>

<hr />

<div id="result" class="alert alert-info d-none"></div>

<p class="text-muted">
    Note: This calculation is not saved.
</p>

<script>
    // Temp guest calculation logic until I implement Fuelo.net API and DB data for Vignettes 

    let vignetteManuallyChanged = false;

    const vignetteTypes = [
        { name: "Weekend", days: 2, price: 10 },
        { name: "Week", days: 7, price: 15 },
        { name: "Month", days: 30, price: 30 },
        { name: "Quarter", days: 90, price: 60 },
        { name: "Year", days: 365, price: 100 }
    ];

    const vignetteSection = document.getElementById("vignetteSection");
    const hasVignette = document.getElementById("hasVignette");
    const vignetteSelect = document.getElementById("vignetteType");

    vignetteSelect.addEventListener("change", () => {
        vignetteManuallyChanged = true;
    });

    vignetteTypes.forEach(v => {
        const opt = document.createElement("option");
        opt.value = v.price;
        opt.text = `${v.name} (€${v.price})`;
        vignetteSelect.appendChild(opt);
    });

    hasVignette.addEventListener("change", () => {
        vignetteSection.style.display = hasVignette.checked ? "none" : "block";
    });

    function calculateCost() {

        const distance = parseFloat(document.getElementById("distance").value);
        const consumption = parseFloat(document.getElementById("consumption").value);
        const fuelPrice = parseFloat(document.getElementById("fuelPrice").value);

        if (isNaN(distance) || isNaN(consumption) || isNaN(fuelPrice)) {
            alert("Please fill in all required fields.");
            return;
        }

        const fuelCost = (distance / 100) * consumption * fuelPrice;

        let vignetteCost = 0;

        if (!hasVignette.checked) {
            const start = new Date(document.getElementById("startDate").value);
            const end = new Date(document.getElementById("endDate").value);

            if (!start || !end || end < start) {
                alert("Please select a valid trip date range.");
                return;
            }

            // Trip duration in days
            const days =
                Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;

            // Pick correct vignette
            const suggested =
                vignetteTypes.find(v => days <= v.days)
                || vignetteTypes[vignetteTypes.length - 1];

            if (!vignetteManuallyChanged) {
                vignetteSelect.value = suggested.price;
            }

            vignetteCost = parseFloat(vignetteSelect.value);
        }

        const total = fuelCost + vignetteCost;

        const result = document.getElementById("result");
        result.classList.remove("d-none");
        result.innerHTML = `
            <strong>Total cost:</strong> €${total.toFixed(2)}<br>
            Fuel: €${fuelCost.toFixed(2)}<br>
            Vignette: €${vignetteCost.toFixed(2)}
        `;
    }
</script>
